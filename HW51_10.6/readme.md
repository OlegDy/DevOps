## Домашнее задание 51 [10.6 Инцидент-менеджмент](https://github.com/netology-code/mnt-homeworks/tree/MNT-video/10-monitoring-06-incident-management)

### Олег Дьяченко DEVOPS-22

## Основная часть

Составьте постмортем на основе реального сбоя системы GitHub в 2018 году.

Информация о сбое: 

* [в виде краткой выжимки на русском языке](https://habr.com/ru/post/427301/);
* [развёрнуто на английском языке](https://github.blog/2018-10-30-oct21-post-incident-analysis/).


## Постмортем

### Краткое описание инцидента

В GitHub произошел инцидент, который привел к ухудшению качества обслуживания в течение 24 часов и 11 минут. 
Были затронуты внутренние системы, что привело к отображению устаревшей и противоречивой информации. 
Данные пользователей не были потеряны. 
В течение большей части инцидента GitHub также не мог обслуживать события webhook, создавать и публиковать сайты GitHub Pages.

### Предшествующие события
В 22:52 UTC 21 октября плановые профилактические работы по замене вышедшего из строя оптического оборудования 100G привели к потере связи 
между сетевыми узлами Востока и Запада. Связь была восстановлена через 43 секунды, но этот кратковременный перебой запустил цепь событий, 
которые привели к ухудшению качества обслуживания.

### Причина инцидента
Потеря связи между сетевыми узлами Востока и Запада на 43 секунды.

### Воздействие
Коллизия Orchestrator, приведшая к не работоспособному кластеру БД. Были затронуты внутренние системы, что привело к отображению устаревшей и противоречивой информации. 
Данные пользователей не были потеряны. В течение большей части инцидента GitHub также не мог обслуживать события webhook, создавать и публиковать сайты GitHub Pages.

### Обнаружение
Система мониторинга. Инцидент был замечен дежурным инженером. Затем были привлечены ответственные разработчики

### Реакция
Изменение статуса сайта на красный. Исправление ситуации в течение 24 часов и 11 минут.

### Восстановление
Восстановление из резервной копии и репликация данных. 

### Таймлайн

**2018 октябрь 21 22:52 UTC**  
Плановые профилактические работы по замене вышедшего из строя оптического оборудования 100G.
Произошла коллизия Orchestrator, кластеры баз данных на Западе и на Востоке стали содержали записи, которых не было в другом центре обработки данных.
Автоматической репликации не произошло.

**2018 октябрь 21 22:54 UTC**  
Система мониторинга начала генерировать оповещения на сбой.
Дежурная смена инженеров определила что БД в режиме репликации, но в репликации отсутствует БД Востока.

**2018 октябрь 21 23:07 UTC**  
Вручную заблокировали инструментарий.
В 23:09 UTC переведен сайт в желтый статус.
В 23:11 UTC координатор инцидента изменил статус на красный.

**2018 октябрь 21 23:13 UTC**  
Проблема затронула несколько кластеров баз данных. 
Были вызваны дополнительные инженеры из команды GitHub по разработке баз данных. 

**2018 октябрь 21 23:19 UTC**  
Прекращена работа push, доставка веб-хуков и сборка GitHub Pages.
Основа - приоритет целостности данных над удобством использования сайта и временем восстановления.

**2018 октябрь 22 00:05 UTC**  
Принято решение восстановить кластер из резервной копии.

**2018 октябрь 22 00:41 UTC**  
Запуск восстановления.

**2018 октябрь 22 06:51 UTC**  
Страница состояния была обновлена ожидаемое время восстановления два часа.

**2018 октябрь 22 07:46 UTC**  
GitHub еле как опубликовал сообщение в блоге.

**2018 октябрь 22 11:12 UTC**  
Пользователи в Европе и США просыпались и начинали рабочий день, нагрузка возростала.
Не все БД реплицировались, поэтому пользователи видели разницу в данных в несколько часов.

**2018 октябрь 22 13:15 UTC**  
Приближалась пиковая нагрузка на GitHub.com. Ввели дополнительные реплики чтения, что позволило репликации наверстать упущенное.

**2018 октябрь 22 16:24 UTC**  
Сохранили статус сервиса красным, начали обрабатывать накопившиеся данные.

**2018 октябрь 22 16:45 UTC**  
Балансировка нагрузки, связанную с накоплением данных. В очереди стояло более пяти миллионов
событий хука и 80 тысяч билдов Pages.
Внесли изменение для увеличения TTL на время.

**2018 октябрь 22 23:03 UTC**  
Все накопленные данные обработаны, целостность и надлежащая работа всех систем подтверждена. Статус сайта обновлен до зеленого.


### Последующие действия

**Устранение несоответствий данных**  
Анализ журналов и определение, какие записи могут быть автоматически согласованы, а какие потребуют 
разъяснительной работы с пользователями.

**Связь**  
Оценки времени инцидента не учитывали всех переменных. Будем стремиться предоставлять более точную информацию в будущем.

**Технические инициативы**  
В ходе данного анализа был выявлен ряд технических инициатив. Поскольку мы продолжаем проводить обширный внутренний анализ после инцидента,
мы ожидаем выявить еще больше работы, которую необходимо выполнить.

* Точная регулировка конфигурации Orchestrator
* Новый механизм отчетности. Более точное отображение работы различных компонентов платформы, статус каждого сервиса.
* Новая инициатива - выдержать полный отказ одного центра обработки данных без ущерба для пользователей. 
* Активная позиция в проверке наших предположений. 

**Организационные инициативы**  
Изменение мышления в отношении надежности сайта. Начнем системную практику проверки сценариев сбоев до того, как они смогут повлиять на пользователя.


