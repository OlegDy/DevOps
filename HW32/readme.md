# Домашнее задание 32 [7.4. Средства командной работы над инфраструктурой](https://github.com/netology-code/virt-homeworks/blob/virt-11/07-terraform-04-teamwork/README.md?plain=1)

## Олег Дьяченко DEVOPS-22

## Задача 2. Написать серверный конфиг для атлантиса. 

Смысл задания – познакомиться с документацией 
о [серверной](https://www.runatlantis.io/docs/server-side-repo-config.html) конфигурации и конфигурации уровня 
 [репозитория](https://www.runatlantis.io/docs/repo-level-atlantis-yaml.html).

Создай `server.yaml` который скажет атлантису:
1. Укажите, что атлантис должен работать только для репозиториев в вашем github (или любом другом) аккаунте.
1. На стороне клиентского конфига разрешите изменять `workflow`, то есть для каждого репозитория можно 
будет указать свои дополнительные команды. 
1. В `workflow` используемом по-умолчанию сделайте так, что бы во время планирования не происходил `lock` состояния.

Создай `atlantis.yaml` который, если поместить в корень terraform проекта, скажет атлантису:
1. Надо запускать планирование и аплай для двух воркспейсов `stage` и `prod`.
1. Необходимо включить автопланирование при изменении любых файлов `*.tf`.

В качестве результата приложите ссылку на файлы [server.yaml](main/server.yaml) и [atlantis.yaml](main/atlantis.yaml)


## Задача 3. Знакомство с каталогом модулей. 

1. В [каталоге модулей](https://registry.terraform.io/browse/modules) найдите официальный модуль от aws для создания
`ec2` инстансов. 
2. Изучите как устроен модуль. Задумайтесь, будете ли в своем проекте использовать этот модуль или непосредственно 
ресурс `aws_instance` без помощи модуля?
3. В рамках предпоследнего задания был создан ec2 при помощи ресурса `aws_instance`. 
Создайте аналогичный инстанс при помощи найденного модуля.   

Переделал код предыдущего [7.3](https://github.com/OlegDy/DevOps/tree/main/HW31) задания, и сделал создание инстансов через модуль, 
модуль взял из [демо](main/modules/instance.tf) лекционного. Теперь и count и each работают совместно, что заметно сократило код, а также улучшило читаемость.

Получилось вот так [prod](main/prodplan.txt) и [stage](main/stageplan.txt), [сам проект](main/main.tf).