# Дамашнее задание 11, "3.7. Компьютерные сети, лекция 2"

## Олег Дьяченко DEVOPS-22

#### 1. Проверьте список доступных сетевых интерфейсов на вашем компьютере. Какие команды есть для этого в Linux и в Windows?

    vagrant@vagrant:~$ ip -c -br link
    lo               UNKNOWN        00:00:00:00:00:00 <LOOPBACK,UP,LOWER_UP>
    eth0             UP             08:00:27:a2:6b:fd <BROADCAST,MULTICAST,UP,LOWER_UP>
    
    vagrant@vagrant:~$ ip -br add
    lo               UNKNOWN        127.0.0.1/8 ::1/128
    eth0             UP             10.0.2.15/24 fe80::a00:27ff:fea2:6bfd/64

    и постаринке 
    vagrant@vagrant:~$ ifconfig
    eth0: flags=4163<UP,BROADCAST,RUNNING,MULTICAST>  mtu 1500
            inet 10.0.2.15  netmask 255.255.255.0  broadcast 10.0.2.255
            inet6 fe80::a00:27ff:fea2:6bfd  prefixlen 64  scopeid 0x20<link>
            ether 08:00:27:a2:6b:fd  txqueuelen 1000  (Ethernet)
            RX packets 46076  bytes 28726440 (28.7 MB)
            RX errors 0  dropped 0  overruns 0  frame 0
            TX packets 39264  bytes 3432925 (3.4 MB)
            TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
    
    lo: flags=73<UP,LOOPBACK,RUNNING>  mtu 65536
            inet 127.0.0.1  netmask 255.0.0.0
            inet6 ::1  prefixlen 128  scopeid 0x10<host>
            loop  txqueuelen 1000  (Local Loopback)
            RX packets 730  bytes 64023 (64.0 KB)
            RX errors 0  dropped 0  overruns 0  frame 0
            TX packets 730  bytes 64023 (64.0 KB)
            TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0


    >ipconfig.exe
    
    Настройка протокола IP для Windows
    
    Адаптер Ethernet Ethernet:
    
       DNS-суффикс подключения . . . . . :
       IPv4-адрес. . . . . . . . . . . . : 172.26.59.220
       Маска подсети . . . . . . . . . . : 255.255.254.0
       Основной шлюз. . . . . . . . . : 172.26.58.1
    
    Адаптер Ethernet VirtualBox Host-Only Network:
    
       DNS-суффикс подключения . . . . . :
       Локальный IPv6-адрес канала . . . : fe80::4cd:108:e4a1:2414%6
       IPv4-адрес. . . . . . . . . . . . : 192.168.56.1
       Маска подсети . . . . . . . . . . : 255.255.255.0
       Основной шлюз. . . . . . . . . :

#### 2. Какой протокол используется для распознавания соседа по сетевому интерфейсу? Какой пакет и команды есть в Linux для этого?

Link Layer Discovery Protocol (LLDP) — протокол канального уровня, который позволяет сетевым устройствам анонсировать в сеть информацию о себе и о своих возможностях, а также собирать эту информацию о соседних устройствах.
Вообще, lldpd поддерживает не только LLDP, но также и CDP, EDP, SONMP и AgentX SNMP.

    Команда ничего не выдала т.к. виртуальная машина, коммутаторов умных нет.
    vagrant@vagrant:~$ lldpctl
    -------------------------------------------------------------------------------
    LLDP neighbors:
    -------------------------------------------------------------------------------

#### 3. Какая технология используется для разделения L2 коммутатора на несколько виртуальных сетей? Какой пакет и команды есть в Linux для этого? Приведите пример конфига.

VLAN имеет те же свойства, что и физическая локальная сеть, но позволяет конечным членам группироваться вместе, даже если они не находятся в одной физической сети. Такая реорганизация может быть сделана на основе программного обеспечения вместо физического перемещения устройств

Для того чтобы информация о созданных VLAN'ах сохранилась после перезагрузки, необходимо добавить её в файл /etc/network/interfaces

Пакет vlan
`apt install vlan`

Настройка VLAN в Ubuntu

    vi /etc/network/interfaces
    auto vlan1400
    iface vlan1400 inet static
     address 192.168.1.1
     netmask 255.255.255.0
     vlan_raw_device eth0
    auto eth0.1400
    iface eth0.1400 inet static
     address 192.168.1.1
     netmask 255.255.255.0
     vlan_raw_device eth0

Создание устройства VLAN командой **ip**

Для интерфейса eth0 и VLAN ID 10 выполните следующие команды:

    # ip link add link eth0 name eth0.10 type vlan id 10
    # ip -d link show eth0.10

Устройство нужно активировать и присвоить ему IP-адрес:

    # ip addr add 192.168.1.200/24 brd 192.168.1.255 dev eth0.10
    # ip link set dev eth0.10 up

#### 4. Какие типы агрегации интерфейсов есть в Linux? Какие опции есть для балансировки нагрузки? Приведите пример конфига.

Bonding – это объединение сетевых интерфейсов по определенному типу агрегации, Служит для увеличения пропускной способности и/или отказоустойчивость сети.
* Mode-0(balance-rr) 
* Mode-1(active-backup) 
* Mode-2(balance-xor) 
* Mode-3(broadcast) 
* Mode-4(802.3ad) 
* Mode-5(balance-tlb)
* Mode-6(balance-alb)

```
    $ sudo nano /etc/network/interfaces
    # The primary network interface
    auto bond0
    iface bond0 inet static
        address 192.168.1.150
        netmask 255.255.255.0    
        gateway 192.168.1.1
        dns-nameservers 192.168.1.1 8.8.8.8
        dns-search domain.local
            slaves eth0 eth1
            bond_mode 0
            bond-miimon 100
            bond_downdelay 200
            bound_updelay 200
```

Netplan — это новая утилита сетевых настроек с помощью командной строки, установленный начиная с Ubuntu 17.10 для легкого управления и сетевых настроек в системах Ubuntu. Она позволяет настроить сетевой интерфейс с использованием абстракции YAML. Он работает совместно с сетевыми демонами NetworkManager и systemd-networkd (называемыми рендерерами, вы можете выбрать, какой из них использовать) в качестве интерфейсов к ядру.

Он считывает сетевую конфигурацию, описанную в файле /etc/netplan/*.yaml. Вы можете хранить конфигурации для всех своих сетевых интерфейсов в этих файлах.

    network: 
        renderer: networkd 
        version: 2 
        ethernets: 
            eth0:
              dhcp4: no
            eth1:
              dhcp4: no
        bonds: 
          bond0:
            dhcp4: no
            interfaces: [eth0, eth1]
            parameters:
              mode: 802.3ad
              mii-monitor-interval: 1

#### 5. Сколько IP адресов в сети с маской /29 ? Сколько /29 подсетей можно получить из сети с маской /24. Приведите несколько примеров /29 подсетей внутри сети 10.10.10.0/24.

    Маска подсети	Префикс, бит   Количество хостов  Количество адресов		    
    255.255.255.248	/29            6                  8

    В сети /24 можно получить 32 подсети.  (256/8=32)

    vagrant@vagrant:~$ ipcalc 192.168.0.1/29
    Address:   192.168.0.1          11000000.10101000.00000000.00000 001
    Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
    Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111
    =>
    Network:   192.168.0.0/29       11000000.10101000.00000000.00000 000
    HostMin:   192.168.0.1          11000000.10101000.00000000.00000 001
    HostMax:   192.168.0.6          11000000.10101000.00000000.00000 110
    Broadcast: 192.168.0.7          11000000.10101000.00000000.00000 111
    Hosts/Net: 6                     Class C, Private Internet

```
vagrant@vagrant:~$ ipcalc 10.10.10.0 255.255.255.0 255.255.255.248
Address:   10.10.10.0           00001010.00001010.00001010. 00000000
Netmask:   255.255.255.0 = 24   11111111.11111111.11111111. 00000000
Wildcard:  0.0.0.255            00000000.00000000.00000000. 11111111
=>
Network:   10.10.10.0/24        00001010.00001010.00001010. 00000000
HostMin:   10.10.10.1           00001010.00001010.00001010. 00000001
HostMax:   10.10.10.254         00001010.00001010.00001010. 11111110
Broadcast: 10.10.10.255         00001010.00001010.00001010. 11111111
Hosts/Net: 254                   Class A, Private Internet

Subnets after transition from /24 to /29

Netmask:   255.255.255.248 = 29 11111111.11111111.11111111.11111 000
Wildcard:  0.0.0.7              00000000.00000000.00000000.00000 111

 1.
Network:   10.10.10.0/29        00001010.00001010.00001010.00000 000
HostMin:   10.10.10.1           00001010.00001010.00001010.00000 001
HostMax:   10.10.10.6           00001010.00001010.00001010.00000 110
Broadcast: 10.10.10.7           00001010.00001010.00001010.00000 111
Hosts/Net: 6                     Class A, Private Internet

 2.
Network:   10.10.10.8/29        00001010.00001010.00001010.00001 000
HostMin:   10.10.10.9           00001010.00001010.00001010.00001 001
HostMax:   10.10.10.14          00001010.00001010.00001010.00001 110
Broadcast: 10.10.10.15          00001010.00001010.00001010.00001 111
Hosts/Net: 6                     Class A, Private Internet

 3.
Network:   10.10.10.16/29       00001010.00001010.00001010.00010 000
HostMin:   10.10.10.17          00001010.00001010.00001010.00010 001
HostMax:   10.10.10.22          00001010.00001010.00001010.00010 110
Broadcast: 10.10.10.23          00001010.00001010.00001010.00010 111
Hosts/Net: 6                     Class A, Private Internet

 4.
Network:   10.10.10.24/29       00001010.00001010.00001010.00011 000
HostMin:   10.10.10.25          00001010.00001010.00001010.00011 001
HostMax:   10.10.10.30          00001010.00001010.00001010.00011 110
Broadcast: 10.10.10.31          00001010.00001010.00001010.00011 111
Hosts/Net: 6                     Class A, Private Internet

 5.
Network:   10.10.10.32/29       00001010.00001010.00001010.00100 000
HostMin:   10.10.10.33          00001010.00001010.00001010.00100 001
HostMax:   10.10.10.38          00001010.00001010.00001010.00100 110
Broadcast: 10.10.10.39          00001010.00001010.00001010.00100 111
Hosts/Net: 6                     Class A, Private Internet

...

 32.
Network:   10.10.10.248/29      00001010.00001010.00001010.11111 000
HostMin:   10.10.10.249         00001010.00001010.00001010.11111 001
HostMax:   10.10.10.254         00001010.00001010.00001010.11111 110
Broadcast: 10.10.10.255         00001010.00001010.00001010.11111 111
Hosts/Net: 6                     Class A, Private Internet

Subnets:   32
Hosts:     192
```

#### 6. Задача: вас попросили организовать стык между 2-мя организациями. Диапазоны 10.0.0.0/8, 172.16.0.0/12, 192.168.0.0/16 уже заняты. Из какой подсети допустимо взять частные IP адреса? Маску выберите из расчета максимум 40-50 хостов внутри подсети.

    Сеть 100.64.0.0 — 100.127.255.255 (маска подсети: 255.192.0.0 или /10) Carrier-Grade NAT.

    vagrant@vagrant:~$ ipcalc 100.64.0.0 /26
    Address:   100.64.0.0           01100100.01000000.00000000.00 000000
    Netmask:   255.255.255.192 = 26 11111111.11111111.11111111.11 000000
    Wildcard:  0.0.0.63             00000000.00000000.00000000.00 111111
    =>
    Network:   100.64.0.0/26        01100100.01000000.00000000.00 000000
    HostMin:   100.64.0.1           01100100.01000000.00000000.00 000001
    HostMax:   100.64.0.62          01100100.01000000.00000000.00 111110
    Broadcast: 100.64.0.63          01100100.01000000.00000000.00 111111
    Hosts/Net: 62                    Class A

#### 7. Как проверить ARP таблицу в Linux, Windows? Как очистить ARP кеш полностью? Как из ARP таблицы удалить только один нужный IP?

Чтобы просмотреть таблицу ARP-кэша, просто введите следующую команду.

    Win:   arp -a
    Linux: arp -n

Чтобы удалить кэш-таблицу, можно воспользоваться утилитой netsh.

    Win: netsh interface IP delete arpcache
    Win: arp -d
    
    Linux: ip -s -s neigh flush all

Если вы хотите удалить какую-либо конкретную запись в кэше, а не всю таблицу.

    Win Linux: arp -d <ip-address>
    
